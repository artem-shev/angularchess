!function(){"use strict";angular.module("chessApp",["ngRoute","ngAnimate","chessApp.common"])}(),function(){"use strict";function e(){var e={templateUrl:"components/chessboard/chessboard.html",controller:"MainCtrl",controllerAs:"ctrl"};return e}angular.module("chessApp").directive("chessboard",e)}(),function(){"use strict";function e(e,o,l){function r(e,o){if(!a.position){if(!o.figure)return;return t=o,t.isSelected=!0,a.figureId=t.figure.id,void(a.position={row:o.row,coll:o.coll})}a.dest={row:o.row,coll:o.coll};var l=i.board.validateMove(a);i.board.makeMove(l),delete t.isSelected,a={},t=void 0}var t,i=this,c=l.player1,s=l.player2,a={};i.board=new o.constructor(8,8,c,s),i.selectCell=r}angular.module("chessApp").controller("MainCtrl",e),e.$inject=["figureService","boardService","userService"]}(),angular.module("chessApp").run(["$templateCache",function(e){e.put("components/chessboard/chessboard.html",'<div>\r\n\t<div ng-repeat="row in ctrl.board.rows" class="row">\r\n\t\t<div ng-repeat="cell in row.cells" class="cell" ng-class="{\'black-cell\': cell.black}" ng-click="ctrl.selectCell($event, cell)">\r\n\t\t\t<img ng-if="cell.figure" ng-src="{{cell.figure.img}}" alt="" class="figure">\r\n\t\t\t\r\n\t\t\t<div ng-if="cell.rowName" class="row-name">{{cell.rowName}}</div>\r\n\t\t\t<div ng-if="cell.collName" class="coll-name">{{cell.collName}}</div>\r\n\t\t\t<div ng-if="cell.isSelected" class="selected"></div>\r\n\t\t</div>\t\t\t\r\n\t</div>\t\r\n</div>\t\r\n')}]),function(){"use strict";angular.module("chessApp.common",[])}(),function(){"use strict"}(),function(){"use strict";function e(e){function o(e){e.forEach(function(e,o){r.player1.figures.push(new e(r.player1,{row:1,coll:o+1})),r.player2.figures.push(new e(r.player2,{row:8,coll:o+1}))});for(var o=1;o<=8;o++)r.player1.figures.push(new t.Pawn(r.player1,{row:2,coll:o})),r.player2.figures.push(new t.Pawn(r.player2,{row:7,coll:o}))}function l(){}var r={constructor:l,player1:{isBlack:!1,figures:[]},player2:{isBlack:!0,figures:[]}},t=e.constructors,i=[t.Rook,t.Knight,t.Bishop,t.Queen,t.King,t.Bishop,t.Knight,t.Rook];return o(i),r}angular.module("chessApp.common").factory("userService",e),e.$inject=["figureService"]}(),function(){"use strict";function e(){function e(e,o){var l=this;l.isBlack=e.isBlack,l.cordinats=o,l.firstMove=!0,l.id=n,n++}function o(o,l){var r=this;e.apply(r,arguments)}function l(o,l){var r=this;e.apply(r,arguments),r.name="pawn",r.value=1,r.isBlack?(r.color="black",r.img="img/bP.png"):(r.color="white",r.img="img/wP.png")}function r(e,l){var r=this;o.apply(r,arguments),r.name="Bishop",r.value=3,r.isBlack?(r.color="black",r.img="img/bB.png"):(r.color="white",r.img="img/wB.png")}function t(e,l){var r=this;o.apply(r,arguments),r.name="Knight",r.value=3,r.isBlack?(r.color="black",r.img="img/bN.png"):(r.color="white",r.img="img/wN.png")}function i(e,l){var r=this;o.apply(r,arguments),r.name="Rook",r.value=5,r.isBlack?(r.color="black",r.img="img/bR.png"):(r.color="white",r.img="img/wR.png")}function c(e,l){var r=this;o.apply(r,arguments),r.name="Queen",r.value=9,r.isBlack?(r.color="black",r.img="img/bQ.png"):(r.color="white",r.img="img/wQ.png")}function s(e,l){var r=this;o.apply(r,arguments),r.name="King",r.isBlack?(r.color="black",r.img="img/bK.png"):(r.color="white",r.img="img/wK.png")}var a={constructors:{Pawn:l,Bishop:r,Knight:t,Rook:i,Queen:c,King:s}},n=1,u=8,p=8;return e.prototype.move=function(e){var o=this;o.cordinats=e,o.firstMove=!1},e.prototype.death=function(){var e=this;e.cordinats=void 0,e.isDead=!0},o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.getAvailableMoves=function(e,o){var l,r,t,i=this,c=[],s=[],a=i.cordinats;return e.movesDescr.forEach(function(i){for(l=1;l<=e.moveLength;l++)if(r=l*i.coll+a.row,t=l*i.row+a.coll,r>0&&r<=u&&t>0&&t<=p&&s.push({row:r,coll:t,kill:!0,basic:!0}),!e.jump){var c=_.find(o,{row:r,coll:t})||{};if(c.figure)break}}),_.each(s,function(e){c.push({figureId:i.id,color:i.color,position:a,dest:e,basic:e.basic,kill:e.kill})}),c},l.prototype=Object.create(e.prototype),l.prototype.constructor=l,l.prototype.getAvailableMoves=function(){var e,o,l=this,r=[],t=[],i=l.cordinats;switch(l.color){case"white":e=1;break;case"black":e=-1}t.push({row:1*e+i.row,coll:0+i.coll,kill:!1,basic:!0}),l.firstMove&&t.push({row:2*e+i.row,coll:0+i.coll,kill:!1,basic:!0});for(var c=1;c<=2;c++){switch(c){case 1:o=1;break;case 2:o=-1}t.push({row:1*e+i.row,coll:1*o+i.coll,kill:!0,basic:!1})}return _.each(t,function(e){e.row>0&&e.row<=u&&e.coll>0&&e.coll<=p&&r.push({figureId:l.id,color:l.color,position:i,dest:e,basic:e.basic,kill:e.kill})}),r},r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype.getAvailableMoves=function(e){var l=this,r={movesDescr:[{row:1,coll:1},{row:1,coll:-1},{row:-1,coll:1},{row:-1,coll:-1}],moveLength:8,jump:!1};return o.prototype.getAvailableMoves.apply(l,[r,e])},t.prototype=Object.create(o.prototype),t.prototype.constructor=t,t.prototype.getAvailableMoves=function(e){var l=this,r={movesDescr:[{row:2,coll:1},{row:2,coll:-1},{row:-2,coll:1},{row:-2,coll:-1},{row:1,coll:2},{row:-1,coll:2},{row:1,coll:-2},{row:-1,coll:-2}],moveLength:1,jump:!0};return o.prototype.getAvailableMoves.apply(l,[r,e])},i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype.getAvailableMoves=function(e){var l=this,r={movesDescr:[{row:0,coll:1},{row:0,coll:-1},{row:1,coll:0},{row:-1,coll:0}],moveLength:8,jump:!1};return o.prototype.getAvailableMoves.apply(l,[r,e])},c.prototype=Object.create(o.prototype),c.prototype.constructor=c,c.prototype.getAvailableMoves=function(e){var l=this,r={movesDescr:[{row:0,coll:1},{row:0,coll:-1},{row:1,coll:0},{row:-1,coll:0},{row:1,coll:1},{row:-1,coll:-1},{row:-1,coll:1},{row:1,coll:-1}],moveLength:8,jump:!1};return o.prototype.getAvailableMoves.apply(l,[r,e])},s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.getAvailableMoves=function(e){var l=this,r={movesDescr:[{row:1,coll:1},{row:1,coll:0},{row:1,coll:-1},{row:0,coll:-1},{row:-1,coll:-1},{row:-1,coll:0},{row:-1,coll:1},{row:0,coll:1}],moveLength:1,jump:!1},t=o.prototype.getAvailableMoves.apply(l,[r,e]);return t},a}angular.module("chessApp.common").factory("figureService",e)}(),function(){"use strict";function e(){function e(e,o,l,r){function t(){s(),a(),n(),v.bindFigures(),v.getAvailableMoves(v.cells)}function i(e,o){for(var l=[],r=e.charCodeAt(0),t=o.charCodeAt(0),i=r;i<=t;i++)l.push(String.fromCharCode(i));return l}function c(e,o){for(var l=[],r=e;r<=o;r++)l.push(r);return l}function s(){for(v.rows=[],p=0;p<e;p++)v.rows.push({row:p+1,cells:[],firstCellBlack:h}),h=!h;v.rows=v.rows.reverse()}function a(){v.rows.forEach(function(e){for(p=0;p<o;p++){var l={row:e.row,coll:p+1,black:e.firstCellBlack,cellName:u(p+1)+e.row};0===p&&(l.rowName=e.row),1===e.row&&(l.collName=u(p+1)),e.cells.push(l),e.firstCellBlack=!e.firstCellBlack}})}function n(){v.cells=[],_.each(v.rows,function(e){v.cells.push(e.cells)}),v.cells=_.flatten(v.cells)}function u(e){if(e<=w.colls.length)return w.colls[e-1];throw new Error("unexpected number of collumns")}var p,v=this,f=i("a","z"),g=c(1,26),h=!0,w={rows:g.slice(0,e),colls:f.slice(0,o)};v.whiteTurn=!0,v.player1=l,v.player2=r,v.figures=_.concat(v.player1.figures,v.player2.figures),v.movesLog=[],v.deadFigures=[],t()}var o={constructor:e};return e.prototype.bindFigures=function(){var e=this;_.each(e.figures,function(o){_.find(e.cells,o.cordinats).figure=o})},e.prototype.getAvailableMoves=function(e){var o=this;o.availableMoves=[],_.each(o.figures,function(l,r){o.availableMoves.push(l.getAvailableMoves(e)),r===o.figures.length-1&&(o.availableMoves=_.flatten(o.availableMoves))})},e.prototype.removeFigure=function(e){var o=this,l=o.figures.indexOf(e);o.deadFigures.push(e),o.figures.splice(l,1)},e.prototype.validateMove=function(e){var o=this,l={startCell:_.find(o.cells,e.position),finishCell:_.find(o.cells,e.dest),dest:e.dest,availableMove:_.find(o.availableMoves,e)};if(!(l.startCell.figure.isBlack&&o.whiteTurn||!l.startCell.figure.isBlack&&!o.whiteTurn)&&l.availableMove)return!l.finishCell.figure&&l.availableMove.dest.basic?l:l.finishCell.figure&&l.availableMove.dest.kill&&l.finishCell.figure.isBlack!=l.startCell.figure.isBlack?(l.killMove=!0,l):void 0},e.prototype.makeMove=function(e){var o=this;if(e){var l=e.startCell.figure;e.killMove&&(e.finishCell.figure.death(),o.removeFigure(e.finishCell.figure),delete e.finishCell.figure),l.move(e.dest),delete e.startCell.figure,o.bindFigures(),o.getAvailableMoves(o.cells),o.whiteTurn=!o.whiteTurn}},o}angular.module("chessApp.common").service("boardService",e)}();